syntax = "proto3";

option go_package = "github.com/o7studios/octopus-sdk/sdk/golang/gen/api/v1;apiv1";

package api.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";


/**
 * Event
 *
 * Represents an event that can occur across services, such as
 * modifying entries, or just any abstract data.
 *
 * The event is identified by a key which follows the format:
 * <system>::<field>::<uuid>
 *
 * - system: The system emitting the event (e.g., SkyWars, Lobby, Shop)
 * - field: The field the system updates (e.g., Permission, Joins, Kills)
 * - uuid: UUID of a Minecraft player or a database object
 */
message Event {
  // The event key used for subscriptions.
  string key = 1;

  google.protobuf.Any data = 2;
}

/**
 * EventHandler
 *
 * Represents an handler which listens to an event on a specific key.
 * It's priority defines when it shall be called.
 */
message EventHandler {
  // Identifier of the handler (e.g. service-name-handler-id)
  string identifier = 1;

  // Key to subscribe to
  string key = 2;

  enum Priority {
    UNKNOWN = 0;
    LOWEST               = 1;
    LOW                  = 2;
    NORMAL               = 3;
    HIGH                 = 4;
    HIGHEST              = 5;
    MONITOR              = 6;
  }

  // Priority defines when this handler shall be called. Lower is later. Default normal.
  optional Priority priority = 3;
}

message EventCall {
  // Identifier of the handler (e.g. service-name-handler-id)
  string identifier = 1;

  Event event = 2;
}